<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Report</title>
  <link rel="stylesheet" href="emp-report.css" />
  <link rel="stylesheet" href="emp-footer.css" />
</head>
<body>
  <div class="report glass">
    <h2>Send Report</h2>
    <input type="text" id="title" placeholder="Title" />
    <textarea id="details" placeholder="Write your report here..."></textarea>
    <button onclick="sendReport()">Send</button>
  </div>

  <footer class="admin-footer">
    <div class="footer-row" id="mainNav">
      <div class="footer-icon" onclick="navigateTo('emp-dashboard.html')">
        <span>ğŸ </span>
        <p>Dashboard</p>
      </div>
      <div class="footer-icon" onclick="navigateTo('profile.html')">
        <span>ğŸ‘¤</span>
        <p>Profile</p>
      </div>
      <div class="footer-icon" onclick="navigateTo('sell.html')">
        <span>ğŸ›’</span>
        <p>Sell</p>
      </div>
      <div class="footer-icon" id="toggleExpand">
        <span>ğŸ”¼</span>
        <p>More</p>
      </div>
    </div>

    <div class="footer-row hidden" id="extraNav">
      <div class="footer-icon" onclick="navigateTo('transactions.html')">
        <span>ğŸ“œ</span>
        <p>Transactions</p>
      </div>
      <div class="footer-icon" onclick="navigateTo('report.html')">
        <span>ğŸ“©</span>
        <p>Reports</p>
      </div>
      <div class="footer-icon" onclick="navigateTo('refund.html')">
        <span>ğŸ”</span>
        <p>Refund</p>
      </div>
      <div class="footer-icon" onclick="logout()" class="logout-btn">
        <span>ğŸ”“</span>
        <p>Logout</p>
      </div>
    </div>
  </footer>

  <script type="module">
    import { db, collection, doc, setDoc, auth } from './firebase.js';

    import { onAuthStateChanged } from './firebase.js';

    function sendReport() {
  const titleInput = document.getElementById('title');
  const detailsInput = document.getElementById('details');
  const button = document.querySelector("button");

  const title = titleInput.value.trim();
  const details = detailsInput.value.trim();

  if (!title || !details) {
    alert("Please fill in both the title and report details.");
    return;
  }

  button.disabled = true;
  button.textContent = "Sending...";

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("User not logged in.");
      button.disabled = false;
      button.textContent = "Send";
      return;
    }

    const employeeName = user.displayName || "Unknown";
    const employeeEmail = user.email || "No Email";
    const date = new Date().toLocaleString();

    try {
      await setDoc(doc(collection(db, 'employeeReports')), {
        title,
        message: details,
        employeeName,
        employeeEmail,
        date,
        sendWhatsApp: true
      });

      // WhatsApp message here...
      const phone = "2348118663849";
      const apikey = "4093230";
      const message = `ğŸ“© *New Employee Report Submitted*
ğŸ‘¤ *Name:* ${employeeName}
ğŸ“§ *Email:* ${employeeEmail}
ğŸ“ *Title:* ${title}
ğŸ—’ *Details:* ${details}
ğŸ“… *Date:* ${date}
ğŸ”— [View Report](https://yourdomain.com/admin-report.html)`;

      await fetch(`https://api.callmebot.com/whatsapp.php?phone=${phone}&text=${encodeURIComponent(message)}&apikey=${apikey}`)
        .then(response => {
          if (!response.ok) throw new Error("WhatsApp message failed");
        });

      alert("Report submitted and admin notified on WhatsApp.");
      location.href = 'employee_dashboard.html';
    } catch (error) {
      console.error("Error:", error);
      alert("An error occurred while sending your report. Please try again.");
      button.disabled = false;
      button.textContent = "Send";
    }
  });
}

    window.sendReport = sendReport;

    function navigateTo(url) {
      window.location.href = url;
    }

    function logout() {
      // Add logout logic here if needed
      alert("Logged out");
    }
  </script>

  <script type="module" src="emp-footer.js"></script>
  <script type="module" src="checkAuth.js"></script>
</body>
</html>